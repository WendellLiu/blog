---
title: HOC èˆ‡RenderPropsï¼Œè«‡æˆ‘å¾å¥¹å€‘èº«ä¸Šå­¸åˆ°ä»€éº¼
description: å‰è¨€
date: '2018-12-03T02:36:13.091Z'
categories: [tech]
tags: [ReactJS, HOC]
layout: layouts/post.njk
---

![Focus on your tools (Photo by [Fleur Treurniet](https://unsplash.com/photos/dQf7RZhMOJU?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/search/photos/tools?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText))](./tools.jpeg)

### å‰è¨€

é€™é™£å­åŒäº‹åœ¨è¨è«–HOC èˆ‡Render Props ï¼Œä»¤æˆ‘æƒ³èµ·å¹´åˆæ™‚é–±è®€äº†é™³æ¦®è¯è€å¸«çš„ _ã€Šæµ·å¾·æ ¼ ã€ˆå­˜æœ‰èˆ‡æ™‚é–“ã€‰é—¡é‡‹ã€‹_ã€‚å…¶ä¸­æµ·å¾·æ ¼å°‡å‘¨é­ä¹‹ç‰©åˆ†ç‚ºåŠæ‰‹ä¹‹ç‰©ï¼ˆReady-to-handï¼‰ä»¥åŠæ‰‹å‰ä¹‹ç‰©ï¼ˆPresent-at-handï¼‰ï¼Œç”¨ä»¥å€åˆ¥é¢å°ä»–è€…çš„æ…‹åº¦ã€‚å‰è€…è¦–ä»–è€…ç‚ºå·¥å…·ï¼Œä»¥ä½¿ç”¨ä½œç‚ºå…¶æ¥è§¸çš„æ–¹å¼ï¼›å¾Œè€…å‰‡æ˜¯å°‡ä»–è€…ç½®æ–¼çœ¼å‰ï¼Œçªå…€åœ°ç ”ç©¶å…¶åŸç†ã€å…§æ¶µã€‚

ä½œç‚ºä¸€å€‹é–‹ç™¼è€…ï¼Œå¤§å¤šæ™‚å€™æˆ‘å€‘åƒ…å°‡ä¸€äº›é–‹ç™¼æ¨¡å¼ï¼ˆpatternï¼‰è¦–ç‚ºåŠæ‰‹ä¹‹ç‰©ï¼Œä¹Ÿå°±æ˜¯å·¥å…·ï¼›è€Œé®®å°‘å°‡å…¶è¦–ç‚ºæ‰‹å‰ä¹‹ç‰©ä¾†ç ”ç©¶ã€‚å…ˆæ’‡é–‹æµ·å¾·æ ¼çš„æ–¹æ³•è«–å§ï¼Œä½œç‚ºå·¥ç¨‹å¸«ï¼Œå¦‚æœå°‘äº†ç ”ç©¶çš„éç¨‹ï¼Œæˆ–è¨±éŒ¯å¤±ä¸€äº›å‘å‰äººå­¸ç¿’çš„æ©Ÿæœƒï¼Œä¸¦ä¸”å¿½ç•¥å…¶æœ¬è³ªè€Œèª¤ç”¨ï¼ˆæˆ–æ¿«ç”¨ï¼‰ã€‚

å› æ­¤æˆ‘æ±ºå®šå¯«ä¸‹æˆ‘è‡ªå·±å°æ–¼HOC èˆ‡Render Props é€™å…©å€‹åœ¨React é–‹ç™¼ä¸Šï¼Œå¸¸è¦‹çš„Code Reuse æ¨¡å¼ã€‚

æœ¬ç¯‡æ–‡ç« è©¦åœ–åŒ…å«ï¼š

*   ä»‹ç´¹React Code Reuse çš„éå¾€æ­·å²
*   åˆ†åˆ¥èªªæ˜é€™å…©è€…çš„ä½¿ç”¨
*   æˆ‘æ€éº¼æ€è€ƒå¥¹å€‘ã€å…·é«”ä¾†èªªå¥¹å€‘åˆ†åˆ¥é—œæ³¨ä»€éº¼ï¼Œä»¥åŠå¯ä»¥å¾ä¸­ç²å¾—ä»€éº¼

å¯èƒ½ä¸åŒ…å«ï¼š

*   è¨±å¤šçš„ä½¿ç”¨æ¡ˆä¾‹
*   å„ªåŠ£çš„æ¯”è¼ƒ
*   æ•ˆèƒ½å‘çš„å»ºè­°

### Code Reuse

ç¨‹å¼ç¢¼çš„å†åˆ©ç”¨ä¸€å‘æ˜¯æ‰€æœ‰å·¥ç¨‹å¸«æ‰€é—œæ³¨çš„å•é¡Œï¼Œæœ‰æ•ˆçš„å†åˆ©ç”¨èƒ½å¤ æ¸›å°‘ç¨‹å¼ç¢¼çš„æ•¸é‡ï¼Œä¸¦ä¸”è®“å¯ç¶­è­·æ€§æé«˜ã€‚ä¹Ÿå› æ­¤ï¼Œç„¡è«–åœ¨ä½•ç¨®é ˜åŸŸçš„è»Ÿé«”ç¤¾ç¾¤ä¸­ï¼Œæå‡ºç¨‹å¼ç¢¼å†åˆ©ç”¨çš„æ¨¡å¼æ˜¯æ¥µå¸¸è¦‹çš„ã€‚React ç¤¾ç¾¤è‡ªç„¶ä¸è½äººå¾Œã€‚

#### Mixins

åœ¨åˆ©ç”¨ `React.createClass` å‰µå»ºä¸€å€‹component çš„å¤æ—©æ™‚æœŸï¼Œé–‹ç™¼è€…å¤šåŠåƒ…èƒ½æ†‘è—‰ mixin  ä¾†åšåˆ°åŠŸèƒ½ä¸Šçš„çµ„åˆã€‚ç¯„ä¾‹å¦‚ä¸‹ï¼Œæ¦‚å¿µä¸Šæ˜¯property merging ã€‚å› æ­¤ç•¶ä¸åŒmixin çš„property name è¡çªæ™‚ï¼Œæœƒç²å¾—è­¦å‘Šä¸€æ”¯ï¼Œä¹Ÿå°±é«”ç¾äº†å…¶é™åˆ¶ã€‚æ›´å¤šè³‡è¨Šå¯åƒè€ƒ [Mixins Considered Harmful](https://reactjs.org/blog/2016/07/13/mixins-considered-harmful.html) é€™ç¯‡æ–‡ç« ã€‚

```js
// mixin example
var mixinDefaultProps = function(foo) {
 return {
     getDefaultProps: function() {
         return {foo: foo}
     }
 }
}

var DivComponent = React.createClass({
    mixins: \[mixinDefaultProps('bar')\],
    render: function(){
        return <div>{this.props.foo}</div>
    }
});

var H1Component = React.createClass({
    mixins: \[mixinDefaultProps('zelta'))\],
    render: function(){
        return <h1>{this.props.foo}</h1>
    }
});
```

#### Classes

æ¥ä¸‹ä¾†çš„å‰ç«¯åœˆé–‹å§‹äº†å¤§ES6 æ™‚ä»£ï¼Œäº¦ç¨±2015 å¹´æ‰€æ‰¹å‡†ECMAScript standard ã€‚æ­¤ä¸€ç‰ˆæœ¬ä¸­è®“javascript é–‹å§‹å¯ä½¿ç”¨class é€™å€‹ä¿ç•™å­—ä½œç‚ºprototype-based objectçš„å‰µå»ºèªæ³•ç³–ã€‚è®“æ·±å—OOP å½±éŸ¿ï¼ˆè¼æ¯’ï¼‰çš„ä¸€çœ¾èƒ½å¤ åœ¨javascript å¯¦ç¾ç†Ÿæ‚‰æœ€å°å‘³çš„ç¹¼æ‰¿ã€å‰µå»ºå­ã€å¯¦ä¾‹ç­‰æ¨¡å¼ã€‚è©³ç´°çš„ä»‹ç´¹è«‹åƒè€ƒé€™ä»½[Babel æ–‡ä»¶](https://babeljs.io/docs/en/learn/#classes)ã€‚

React è‡ªç„¶ä¸æœƒæ”¾éé€™å€‹æ©Ÿæœƒï¼Œè—‰ç”±class èªæ³•å–ä»£åŸæœ¬ `React.createClass` çš„å…ƒä»¶å‰µé€ ï¼Œä½¿ç¨‹å¼ç¢¼æ›´åŠ æ¸…æ™°ã€‚methodã€static methodã€constructor ç­‰ç”¨æ³•å‰‡è®“component çœ‹èµ·ä¾†æ›´åƒä¸€å€‹ç´”ç²¹çš„javascript å…§å®¹ã€‚

è€ŒReact Class Component ä¸¦ä¸æ”¯æ´mixin ï¼Œä½†ç•¶ç„¶ï¼Œä½ çŸ¥é“çš„ï¼Œåœ¨class ç¹¼æ‰¿æ˜¯å¯ä»¥çš„ï¼Œå› æ­¤åŒæ¨£èƒ½å¤ ä¾å¾ª **mixins** æ¨¡å¼é”åˆ°ç¨‹å¼ç¢¼å†åˆ©ç”¨ã€‚

Extend Custom Class Component

ç”±æ–¼Class Extending ä¾èˆŠå±¬æ–¼property merging ï¼Œå› æ­¤ä»ç¨±ä¸ä¸Šå¤ªå¤§çš„çªç ´ã€‚å¯¦éš›ä¸Šï¼Œåœ¨æ…¢æ…¢æ·˜æ±° `React.createClass` çš„é€™å€‹æ™‚æœŸï¼ŒReact ç¤¾ç¾¤ä¾¿å·²ç¶“é–‹å§‹æ¨å»£HOC çš„æ¦‚å¿µï¼Œæ‰€ä»¥å€’æ˜¯æ²’çœŸçš„çœ‹éå¤šå°‘Class Extending çš„å¯¦éš›æ‡‰ç”¨ã€‚

å¥½çš„ï¼Œè®“æˆ‘å€‘é€²å…¥æ­£é¡Œå§ï¼Œè«‡è«‡ç¾ä»Šå¸¸è¢«æå‡ºçš„å…©ç¨®Code Reuse Patternã€‚

### æ‰€è¬‚ç¾ä»£çš„Code Reuse inÂ React

#### HOC(Higher-Order Component)

æœ¬ç¯‡ä¸æ˜¯ä»€éº¼ç¡¬åº•å­æ–‡ç« ï¼Œæ‰€ä»¥æˆ‘å€‘ç›´æ¥çœ‹code å§ã€‚

HOC for everything

åœ¨é€™è£¡æˆ‘åšäº†äº”ä»¶äº‹ï¼š

1.  å®šç¾©ä¸€å€‹UI å‹å…ƒä»¶**Page**ï¼Œå°‡props çš„è³‡æ–™ç°¡å–®çš„è½‰æˆUI
2.  å®šç¾©ä¸€å€‹HOCâ€Šâ€”â€Š**numberAddOne** ï¼Œç›®çš„æ˜¯å°‡ `props.number` æ•¸å€¼åŠ ä¸€
3.  å®šç¾©ä¸€å€‹HOCâ€Šâ€”â€Š**greetingWithName**ï¼Œç›®çš„æ˜¯å°‡ `props.greeting` åŠ ä¸Šä¸€å€‹è‡ªå®šç¾©çš„åå­—
4.  å®šç¾©ä¸€å€‹HOCâ€Šâ€”â€Š**addATitle**ï¼Œç›®çš„æ˜¯ç„¡è«–ä½•ç¨®UI ï¼Œéƒ½çµ¦æˆ‘åŠ ä¸Šä¸€å€‹h1 title
5.  æŠŠä¸Šé¢é€™äº›HOC ä¸€ä¸€å¥—ç”¨åœ¨**Page** ä¸Šæˆç‚ºæœ€çµ‚è¢«ä½¿ç”¨çš„**App**

HOC ï¼ŒHigh-Order Component ï¼Œä¸­æ–‡å¯ä»¥è­¯ç‚ºã€Œé«˜éšå…ƒä»¶ã€ï¼Œåˆæˆ–è€…å¾ˆä¿—æ°£åœ°ç¨±å‘¼å¥¹ç‚ºã€Œå…ƒä»¶æ”¹é€ ç”¢ç”Ÿå™¨ã€ã€‚ç¸½ä¹‹ï¼Œå°±æ˜¯å¯ä»¥ä¸€å€‹**å¯çµ„åˆã€è¦†å¯«ã€ç·¨è¼¯ä¸Šå±¤è³‡æ–™èˆ‡UI ï¼Œæˆç‚ºä¸€å€‹æ–°å…ƒä»¶çš„å‡½å¼**ã€‚

è¢å¹•å‰çš„ä½ çœ‹å®Œä¸Šé¢ç¨‹å¼ç¢¼å¯èƒ½æœƒæƒ³ä¸€æ‹³[ã§Œï¼ˆmauï¼‰](https://www.moedict.tw/%27%E3%A7%8C)ä¸Šä¾†ï¼Œå°æˆ‘ç ´å£ç½µã€Œä½•ä¸æŠŠé€™äº›HOC åƒåœ¨ä¸€èµ·åšæˆä¸€å€‹HOC é›œç‡´ã€ã€‚å¯¦éš›ä¸ŠçœŸè¦é€™æ¨£åšçš„ç¢ºå¯è¡Œï¼Œé€™å€‹ç¯„ä¾‹ä¸­çš„å¤šå±¤çš„HOC ä¹Ÿæ˜¯å¢åŠ äº†[Call stack](https://en.wikipedia.org/wiki/Call_stack) sizeï¼Œè‡³å°‘åœ¨ã€Œæ•ˆèƒ½ï¼Œä¸€é»éƒ½ä¸èƒ½å°‘ã€çš„å…±è­˜ä¸‹ï¼Œç¢ºå¯¦æœ‰å…¶ç–‘æ…®ã€‚

ä¸€ä¾†å‰é ­å·²ç¶“æ‰“éé é˜²é‡ï¼Œæœ¬ç¯‡ä¸æ¶‰åŠæ•ˆèƒ½å•é¡Œï¼›äºŒä¾†ï¼Œæ–¼æˆ‘è€Œè¨€ï¼Œæ¯”èµ·æ•ˆèƒ½ï¼Œæ›´é‡è¦çš„æ˜¯å…ƒç´ çš„ç´”æ·¨æ€§ï¼Œæ‰€ä»¥æˆ‘æœƒå‚¾å‘å°‡æ¯ç¨® **ã€Œæ¦‚å¿µã€** åˆ†åˆ¥ç½®å…¥ä¸åŒçš„HOC ï¼Œå¦‚æ­¤æ›´èƒ½è®“æœªä¾†çš„ç¶­è­·è€…åœ¨ä¸ç´°çœ‹ç¨‹å¼ç¢¼çš„å‰æä¸‹ï¼Œä¸€ç›®äº†ç„¶æ­¤å®Œæˆé«”æ˜¯è¢«è³¦äºˆå“ªäº›è²¬ä»»ã€‚

è‹¥é–‹ç™¼è€…å®³æ€•

`const App = addATitle(greetingWithName(â€˜Hello')(numberAddOne(Page)))`

é€™ç¨®åš‡äººä¸å¥½è®€ç¨‹å¼ç¢¼å‡ºç¾ï¼Œå¯ä»¥å–„ç”¨å„å¤§å·¥å…·åº«ï¼ˆe.g. ramda, recompose, lodash, etc.ï¼‰æ‰€æä¾›çš„ `compose` å‡½æ•¸ä¾†çµ„åˆï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š

```js
import { compose } from 'recompose';

const hoc = compose(
  `addATitle,
  greetingWithName(â€˜Hello'),
  numberAddOne,
);`

const App = hoc(Page);
```

èª å¦‚ä¸Šé¢æ‰€èªªï¼Œå¤šå±¤HOC ä¸æ˜¯æ²’æœ‰æ•ˆèƒ½ç–‘æ…®ï¼Œæ‰€ä»¥åœ¨æ•ˆèƒ½èˆ‡ç¶­è­·æ€§ä¸Šï¼Œç«¯çœ‹å„ä½çš„å–æ¨ã€‚

å¦å¤–ï¼Œè‹¥èƒ½å–„ç”¨curryã€closure ç­‰æŠ€å·§ï¼Œä¹Ÿå¯ä»¥å°‡ä¸Šå±¤æƒ…å¢ƒçš„è³‡æ–™ä¹Ÿä¹¾æ·¨åœ°æ”¾å…¥ä¸‹å±¤å…ƒä»¶ï¼Œæœ‰åŠ©æ–¼å¯«å‡ºæ›´åŠ ç´”æ·¨çš„å…ƒä»¶ã€‚ä¾‹å¦‚ä¸Šé ­çš„ `greetingWithName`ï¼Œåœ¨å‰µå»ºæ™‚ä¾¿èƒ½å¾æœ€ä¸Šå±¤çš„scope å‚³å…¥æ‰“æ‹›å‘¼çš„å…§å®¹ï¼Œè€Œå¾Œå†èˆ‡name ä¾†çµ„åˆæˆæœ€å¾Œå‘ˆç¾çš„çµæœã€‚é€™è£è®“æˆ‘è¶æ©Ÿæ‰“ä¸€ä¸‹èˆŠæ–‡[ã€Šç´”ç²¹çš„å¥½ï¼ŒPure Function çŸ¥é“ã€‹](https://medium.com/frochu/%E7%B4%94%E7%B2%B9%E7%9A%84%E5%A5%BD-pure-function-%E7%9F%A5%E9%81%93-574d5c0d7819)ã€‚

æœ€ç¶“å…¸çš„HOC ç¬¬ä¸‰æ–¹å¥—ä»¶æ˜¯[Recompose](https://github.com/acdlite/recompose) ï¼Œè£¡é ­æœ‰è¨±å¤šHOC ä»¥åŠHOC Utilities ï¼Œä¾‹å¦‚å°‡React Component çš„state å‰µå»ºèˆ‡lifecycle éƒ½åŒ…è£¹æˆHOC ï¼Œé‹ç”¨å¾—å®œï¼Œç¨‹å¼ç¢¼å¹¾ä¹å‰©ä¸‹HOC èˆ‡ç´”UI çš„Functional Componentã€‚ä¸ééš¨è‘—å‰é™£å­React Hooks çš„å•ä¸–ï¼Œæœ¬äººä¹Ÿåœ¨React Team çš„åŸä½œè€…ä¹Ÿ[å®£å¸ƒæœƒåœæ­¢ç©æ¥µç¶­è­·Recompose](https://github.com/acdlite/recompose#a-note-from-the-author-acdlite-oct-25-2018) ã€‚

#### Render Props

Render Props ä¸¦ä¸æ˜¯ä¸€é–€æ–°çš„æŠ€è¡“ï¼Œç”šè‡³ä¸èƒ½ç®—æ˜¯ä¸€ç¨®æ–°çš„æ¨¡å¼ï¼ŒåŸå› å…ˆçœ‹å®Œä»¥ä¸‹çš„ç¯„ä¾‹ç¢¼å†è¡Œèªªæ˜ã€‚

Render Props to share code

åœ¨é€™è£¡æˆ‘åšäº†å››ä»¶äº‹ï¼š

1.  å®šç¾©ä¸€å€‹Layout UI Component **CenterBlock**ï¼Œä½œç”¨æ˜¯å°‡**props.render** å‡½æ•¸æ‰€ç”¢ç”Ÿå‡ºçš„Component ä»¥ä¸€å€‹æœƒç›´æ’ã€ç½®ä¸­çš„wrapper åŒ…è¦†ï¼Œä¸¦ä¸”è©²wrapper æœƒç”±**props.backgroundColor** æ±ºå®šæ•´å€‹**CenterBlock** çš„background color
2.  åœ¨**App** ä¸­ï¼Œå®šç¾©ä¸€å€‹class method æ˜¯**renderBlock1** ï¼Œä½œç”¨æ˜¯ ç”¢ç”Ÿä¸€å€‹h1, h2 çµ„åˆè€Œæˆçš„UI
3.  åœ¨App çš„render ä¸­ï¼Œä½¿ç”¨**CenterBlock** ï¼Œprops.render ç‚ºä¸Šè¿°å®šç¾©çš„**renderBlock1** ï¼Œä¸¦ä¸”çµ¦äºˆprops.backgroundColor ä¸€å€‹æŒ‡å®šçš„é¡è‰²
4.  åœ¨App çš„render ä¸­ï¼Œä½¿ç”¨CenterBlock ï¼Œprops.render ç‚ºä¸€å€‹inline functionï¼Œç”¢ç”Ÿä¸€å€‹ç”±pã€ul æ‰€çµ„åˆè€Œæˆçš„UI ï¼Œä¸¦ä¸”çµ¦äºˆprops.backgroundColor ä¸€å€‹æŒ‡å®šçš„é¡è‰²

å¤§è‡´çœ‹ä¾†ï¼ŒRender Props æ˜¯**ä¸€å€‹å‡½æ•¸ï¼Œæè¿°äº†ä¸€æ®µUI ï¼Œä¸¦ä¸”å…·å‚™å¯ä»¥ç›´æ¥å¾å…¶ä»–æƒ…å¢ƒçš„Component ä¸­å–å¾—è³‡æ–™çš„èƒ½åŠ›**ï¼ˆä¸Šè¿°ä¾‹å­ä¸­ï¼Œä»»ä½•ä½œç‚ºrender çš„å‡½æ•¸çš†æœ‰é€”å¾‘å¯å¾**CenterBlock** å–å¾—è³‡æ–™ï¼‰ã€‚

Render Props çš„ç¯„ä¾‹ä¸­ï¼Œå¯ä»¥ç™¼ç¾ï¼Œé€™å¹¾ä¹å°±æ˜¯children çš„ä½¿ç”¨æ–¹å¼ã€‚ç•¶ç„¶ï¼Œå‚³çµ±ä¸Šï¼Œç”±æ–¼JSX çš„æ–¹ä¾¿æ€§ï¼Œæˆ‘å€‘æœƒå‚¾å‘åœ¨children çµ¦äºˆä¸€å€‹Element è€Œä¸æ˜¯Component ï¼ˆé—œæ–¼Element èˆ‡Component çš„åè©å®šç¾©å¯ä»¥åƒè€ƒ[é€™ç¯‡](https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html)ï¼Œä½ ä¹Ÿå¯ä»¥åƒè€ƒæˆ‘åº•ä¸‹çš„å‚™è¨» \*1ï¼‰ã€‚ä¹Ÿå› æ­¤ï¼Œæœ¬æ®µçš„é–‹é ­æ‰å¯«é“Render Props ä¸¦éä¸€å€‹æ–°çš„æ¨¡å¼ï¼Œåªæ˜¯åœ¨ç´„2017å¹´åº•æ‰é–‹å§‹ä»¥ã€ŒCode Reuse æ¨¡å¼ã€çš„å®šä½å—æ¨å»£ã€‚ï¼ˆ2017 å¹´åº•æ˜¯è¬¹ä»¥æˆ‘çš„å°è±¡èˆ‡ç´„ç•¥æŸ¥åˆ°çš„æ¨å»£æ–‡ç« ç™¼è¡¨æ™‚é–“è«–å®šï¼Œæœ‰å…¶ä»–æ›´åˆé©çš„ç­”æ¡ˆä¹Ÿéº»ç…©å‘Šè¨´æˆ‘ï¼‰

é‹ç”¨Render Props çš„ç¯„ä¾‹ä¸å°‘ã€‚æ—©æœŸç‰ˆæœ¬çš„React Router å·²æœ‰render é€™å€‹props æä¾›é–‹ç™¼è€…ç°¡æ½”åœ°æŒ‡å®šMatched Route æœƒå‘ˆç¾çš„View ã€‚è€ŒReact Apollo v2.1 ä¹Ÿå…¬é–‹äº†Render Props çš„API ï¼Œè®“é–‹ç™¼è€…ç›´æ¥åœ¨ `<Query>` èˆ‡ `<Mutation>` çš„children å‚³å…¥Render Props Function ï¼Œä»¥å–å¾—query èˆ‡mutation çš„æ–¹æ³•èˆ‡è³‡æ–™ï¼Œè®€è€…å¯åƒè€ƒæ­¤[é€£çµ](https://blog.apollographql.com/introducing-react-apollo-2-1-c837cc23d926)ã€‚

é™¤äº†ç¬¬ä¸‰æ–¹å¥—ä»¶çš„æ‡‰ç”¨å¤–ï¼ŒReact Core æœ¬èº«åœ¨æ–°ç‰ˆçš„Context API ä¹Ÿå·§å¦™åœ°é‹ç”¨äº†Render Props ã€‚æ–°ç‰ˆçš„Context API ä¸­ï¼Œé–‹ç™¼è€…å¿…é ˆå…ˆåˆ©ç”¨ `React.createContext` å‰µå»ºå‡ºå…©å€‹å¯¦ä¾‹ï¼Œåˆ†åˆ¥ç‚ºProvider èˆ‡Consumer ã€‚Provider çš„åŠŸç”¨æ˜¯æä¾›context value ï¼Œè€ŒConsumer é¡§åæ€ç¾©æ˜¯è®“é–‹ç™¼è€…**ä½¿ç”¨**context value ã€‚å…¶ä¸­Consumer çš„ä½¿ç”¨ä¸Šï¼Œé–‹ç™¼è€…å¿…é ˆä»¥ `ContextValue -> ReactElement` é€™æ¨£çš„Render Props Function ä¾†æ‰¿æ¥context value ã€‚

### æ®Šé€”åŒæ­¸

é™¤äº†é€™å¹¾å¹´æåŠå‡½æ•¸äºŒå­—å°±æœƒé¡¯å¾—å¾ˆæ½®ä»¥å¤–ï¼Œåœ¨ä»¥ä¸Šçš„å…§å®¹ä¸­ï¼Œå‡½æ•¸é€™å€‹è©ä¸æ–·åœ°å‡ºç¾ï¼Œä¹ƒå› ç„¡è«–æ˜¯HOC æˆ–æ˜¯Render Props ï¼Œæ­¤äºŒæ¨¡å¼åŸºæœ¬æ˜¯å»ºç«‹æ–¼å–®ä¸€å€‹åè¶³ç°¡å–®çš„å‡½æ•¸ä¹‹ä¸Šï¼Œä¸¦æ²’æœ‰ä»€éº¼é­”æ³•ã€‚æ‰€è¬‚ç°¡å–®çš„å®šç¾©æ˜¯éš¨äººè€Œå®šï¼Œæœ¬æ–‡æƒ³è¡¨é”çš„ç°¡å–®ï¼Œä¹ƒæ˜¯ä»¥**ã€Œé–‹ç™¼è€…å¤šæœ‰å¯èƒ½å¯«å‡ºæœ€ç°¡å–®çš„ç¨‹å¼ç¢¼ï¼Œä»¥é”åˆ°ç›®çš„ã€**çš„æ¨™æº–ä¸‹çš„ç°¡å–®ã€‚æ›è¨€ä¹‹ï¼Œé–‹ç™¼è€…ä¸éœ€ç†Ÿè¨˜å„å¼ç‰¹å®šAPI ï¼Œç”šè‡³ä¸éœ€è¦äº†è§£è¤‡é›œçš„ç¹¼æ‰¿ç³»çµ±ï¼ˆæˆ–èªªextends ï¼Œäº¦æˆ–èª¬prototypeï¼‰ï¼Œé€™æ˜¯æœ¬æ–‡æ‰€è¬‚çš„ç°¡å–®ã€‚

åœ¨æ­¤åŸºç¤ä¸‹ï¼Œæˆ‘èªç‚ºHOC èˆ‡Render Props æ˜¯æ®Šé€”åŒæ­¸çš„ï¼Œä¹Ÿå°±æ˜¯**æ›´å¤šå…ƒçš„å‡½æ•¸åˆ©ç”¨**ã€‚

### å¦‚ä½•çœ‹å¾…

ä¸€å¦‚æœ¬æ–‡é–‹é ­æ™‚æ‰€èªªï¼Œåœ¨ä½¿ç”¨ä¸Šï¼ŒHOC èˆ‡Render Props æ˜¯æ®Šé€”åŒæ­¸çš„ï¼Œé–‹ç™¼è€…åƒ…éœ€ç†ŸçŸ¥æ¥å£çš„ä½ç½®ä»¥åŠä½¿ç”¨çš„ç¯„æœ¬ï¼Œä¸¦ä¸”å‚³å…¥å¯Œå«å•†æ¥­é‚è¼¯æˆ–UI çš„å‡½æ•¸å³å¯ã€‚ç„¶è€Œï¼Œæˆ‘æ‰“ç®—é–’é–’ç„¡ä»£èªŒï¼Œä»¥æˆ‘è‡ªå·±çš„ä½¿ç”¨æ–¹å¼ä½œç‚ºç ”ç©¶å°è±¡ï¼Œå°‡é€™å…©è€…æ‰˜æ–¼æ‰‹ä¸Šç«¯è©³ï¼Œæ¢å°‹å¯èƒ½ç„¡ç”¨çš„è§€é»ã€‚

#### HOC

é¦–å…ˆï¼ŒHOC æœ¬è³ªå°±æ˜¯Functional Programming è£¡å¿…æåŠçš„HOFï¼ˆHigh-Order Functionï¼‰ã€‚é€™è£¡çµ¦ä¸€å€‹HOF çš„ç¯„ä¾‹ç¢¼ï¼ŒcomplexMath æœƒæ¥æ”¶ä¸€å€‹filter function ï¼Œä¸¦ä¸”å†æ¥æ”¶ä¸€å€‹æ•´æ•¸ï¼Œæœ€å¾Œä»¥filter function ç¯©é¸æ¯ä¸€ä½çš„æ•¸å­—ï¼Œä¸¦ä¸”é‡æ–°çµ„æˆæ–°çš„æ•´æ•¸ã€‚å‘ƒï¼Œæˆ‘çŸ¥é“flow çš„primitive types å»ºç«‹åœ¨javascript ä¹‹ä¸Šæ‰€ä»¥æ²’æœ‰`Nat` ï¼ˆè‡ªç„¶æ•¸ï¼‰ï¼Œä½†æˆ‘æ‡¶å¾—è™•ç†è² æ•¸èˆ‡å°æ•¸é»ï¼Œæ‰€ä»¥å°±è®“æˆ‘å·æ‡¶é™åˆ¶åœ¨è‡ªç„¶æ•¸å§ ğŸ˜ ã€‚ç¯„ä¾‹ç¢¼å¦‚ä¸‹ï¼š

```js
// @flow
type ComplexMath = (filterNat: `Nat` => boolean) => (n: `Nat`) => `Nat`

const complexMath: ComplexMath = filterNat => n => {
  const result = n.toString().split('').filter(filterNat).join('');
  return Number(result);
};

const fn = complexMath(n => n > 5);
expect(fn(6125499)).to.equal(699) // pass!
```

æœ¬ä¾‹ä¸­complexMath æ˜¯ç‚ºä¸€å€‹HOF ï¼ŒHOF çš„å»£ç¾©å®šç¾©ç‚ºã€Œè‡³å°‘æ¥æ”¶ä¸€å€‹å‡½æ•¸ï¼Œæˆ–è€…å›å‚³ä¸€å‡½æ•¸çš„å‡½æ•¸ã€ï¼Œä½ ä¹Ÿå¯ä»¥åƒè€ƒ[ç¶­åŸºç™¾ç§‘](https://www.wikiwand.com/en/Higher-order_function)ã€‚è§€å¯Ÿä¸Šé¢é€™æ®µç¯„ä¾‹ç¢¼ï¼Œè‹¥æŠŠ `n` èˆ‡ `Number(result)`éƒ½è¦–ç‚ºReact Component ï¼Œé‚£ä¹Ÿå°±æ˜¯ä¸€å€‹HOC äº†ã€‚

èµ·åˆçš„React è¨­è¨ˆå“²å­¸è£¡ä¾¿å¼·èª¿äº†ï¼ŒReact æ‰€åšçš„äº‹å¯ç”¨ `F(state) => UI` ä¾†æ¦‚æ‹¬ï¼Œé€™è£¡çš„state æ˜¯å»£ç¾©ä¸‹ä»»ä½•æè¿°UI çš„ç‹€æ…‹è³‡æ–™ï¼Œæ„å³UI å¯ä»¥ä¸€çµ„å‡½æ•¸ä¾†è¡¨ç¤ºã€‚åœ¨é€™å€‹è„ˆçµ¡åº•ä¸‹ï¼Œæˆ‘èªç‚ºHOC å†ä¸€æ¬¡å¼·åŒ–äº†æ­¤æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ **ã€Œå…ƒä»¶å³å‡½æ•¸ã€**ã€‚

ä»¥æˆ‘è‡ªå·±çš„ä½¿ç”¨ç¿’æ…£ï¼Œç”±æ–¼HOC æœ¬èº«å³ç‚ºä¸€å‡½æ•¸ï¼Œå› æ­¤æ¥µåˆé©æ–¼å»ºé€ è™•ç†è³‡æ–™çš„pipe line ï¼Œå°‡æ¯ä¸€å€‹è³‡æ–™çš„çµ„åˆã€è¨ˆç®—åˆç†åœ°åˆ‡åˆ†åœ¨æ¯ä¸€å€‹HOC ã€‚å†è—‰ç”±compose å‡½æ•¸ï¼Œè®“é–‹ç™¼è€…ä¸éœ€è¦åƒé›œUI é‚è¼¯ï¼Œçµ„åˆæˆç´”ç´”æ­£æ­£ã€æ­£æ­£ç•¶ç•¶çš„ä¸€æ¢è³‡æ–™å‘çš„ç®¡ç·šã€‚è€Œä½æ–¼ç®¡ç·šæœ€ä¸‹æ¸¸çš„React Component ï¼Œåƒ…éœ€å°ˆæ³¨æ–¼æè¿°**ä¾æ“šprops æ‰€æ‡‰ç•¶å‘ˆç¾çš„View** å³å¯ã€‚

#### Render Props

ä¸Šé ­HOC çš„å…§å®¹æåˆ°ï¼ŒReact æ‰€åšçš„äº‹å¯ä»¥**F(state) = UI** æ¦‚æ‹¬ï¼Œè€ŒRender Props åœ¨é€™è£¡å‰‡æ˜¯ä¸€å€‹**å‹•æ…‹**çš„state ï¼Œæˆ‘å–œæ­¡ç”¨ **ã€Œfunction in configã€** ä¾†ä»£è¡¨å¥¹çš„è§’è‰²ã€‚Render Props æœ‰æ•ˆåœ°è®“é–‹ç™¼è€…åœ¨é–‹ç™¼éç¨‹ä¸­ç¨ç«‹å‡ºParent Component è™•ç†è³‡æ–™ä»¥åŠç”¢ç”ŸUI çš„é‚è¼¯ã€‚è€Œæ›å¥è©±èªªä¹Ÿå°±æ˜¯è®“å„é¡è™•ç†è³‡æ–™ã€side effect çš„Component å¯æ›´ç°¡æ½”åœ°è¢«å†åˆ©ç”¨ã€‚

å‹•æ…‹æ˜¯ä¸€æŠŠå…©é¢åˆƒï¼Œæˆ‘èªç‚ºRender Props æ˜¯ä¸€å€‹å½ˆæ€§å°å‘çš„æ¨¡å¼ï¼Œå¥½è™•æ˜¯å¯è®“é–‹ç™¼è€…å¿«é€Ÿã€å…·å½ˆæ€§åœ°å†åˆ©ç”¨å¾ˆå¤šé‚è¼¯ï¼Œç”šè‡³å¯ä»¥ç›´æ¥ä»¥inline function åœ¨props ç›´æ¥å¯«å‡ºrender çš„çµæœã€‚ç„¶è€Œé–‹ç™¼è€…å¿…é ˆè‡ªå¾‹åœ°ä¸å¯«å‡ºéåº¦ç¹è¤‡æµç¨‹ã€ç”¢ç”Ÿéå¤šå±¤æ¬¡React Element çš„å‡½æ•¸ï¼Œæ‰èƒ½ç¢ºä¿ç¨‹å¼ç¢¼è¤‡é›œåº¦ä¸éš¨è‘—Render Props çš„ä½¿ç”¨è€Œæé«˜ã€‚

å¦å¤–ï¼Œç”±æ–¼Render Props Function åœ¨åŸ·è¡Œå®Œå¾Œæ˜¯å¾ˆç›´ç™½åœ°å›å‚³ä¸€çµ„React Element ã€‚å› æ­¤ç›¸è¼ƒæ–¼HOCï¼ŒRender Props ä¸¦ä¸æœƒå°è‡´vDOM treeå¤šä¸€å±¤ï¼Œé›–ç„¶function call stack ä¸¦æ²’æœ‰éš¨ä¹‹æ¸›å°‘ï¼Œä½†æ¸›å°‘vDOM treeçš„é«˜åº¦æ–¼å°React Core çš„è™•ç†æ˜¯æœ‰åˆ©ç„¡å®³çš„ã€‚

### çµ

ç¸½çµæœ¬æ–‡çš„å…§å®¹ï¼š

1.  HOC æ´»ç”¨äº†å…ƒä»¶å³å‡½æ•¸â€Šâ€”â€Š**F(state) = UI** çš„æ¦‚å¿µ
2.  HOC é©åˆæ‰“é€ data pipeline
3.  Render Props ç¨ç«‹äº†è³‡æ–™èˆ‡UI é‚è¼¯
4.  Render Props èƒ½æ¸›å°‘vDOM treeçš„é«˜åº¦ï¼Œä¸¦ä¸”æœ‰å½ˆæ€§åœ°ä»¥inline function é–‹ç™¼

è³‡è¨Šçš„åœˆå­æ™‚æ™‚æœ‰æ–°é®®äº‹ï¼Œç«™åœ¨å‰ç·šçš„å·¥ç¨‹å¸«æ˜¯æœ€å®¹æ˜“å¿˜è¨˜åœä¸‹è…³æ­¥ã€å®šç›æ–¼æ‰‹ä¸­å·¥å…·çš„æ—ç¾¤ã€‚ç„¶è€Œæˆ‘èªç‚ºé€™æ¨£çš„ç ”ç©¶éç¨‹æœ‰åŠ©æ–¼æ¢³ç†å°å·¥å…·çš„é‹ç”¨æ™‚æ©Ÿã€é™åˆ¶ã€æŠ½è±¡ä»¥åŠå»¶ä¼¸ï¼Œç”šè‡³å°æ–¼æœªä¾†é–‹ç™¼å…§éƒ¨ä½¿ç”¨çš„å‡½å¼åº«ï¼Œç”šè‡³æ˜¯é–‹æ”¾çš„ç¬¬ä¸‰æ–¹å¥—ä»¶å“è³ªï¼Œçš†æœ‰åŠ©ç›Šã€‚æˆ‘å€‘ä¸åªæ˜¯é–‹ç™¼è€…ï¼Œä¹Ÿæ‡‰è©²æ˜¯å€‹ç ”ç©¶è€…èˆ‡å‰µé€ è€…ã€‚

> Man cannot be free if he does not know that he is subject to necessity, because his freedom is always won in his never wholly successful attempts to liberate himself from necessity. (The Human Condition)

### ğŸå·¥å•†ğŸ

[**honestbee career - _Join our big exciting family_**
Join our big exciting familycareers.honestbee.com](https://careers.honestbee.com/ "https://careers.honestbee.com/")[](https://careers.honestbee.com/)

honestbee ğŸæ­£åœ¨æ‹›å‹Ÿå‰ç«¯å·¥ç¨‹å¸«ï¼Œä¹Ÿå°±æ˜¯æˆ‘çš„åŒäº‹ã€‚è‹¥ä½ è®€åˆ°é€™ï¼Œä¹Ÿæ„Ÿåˆ°æœ‰èˆˆè¶£ï¼Œæ­¡è¿åƒè€ƒé€™å€‹[é€£çµ](https://careers.honestbee.com/departments/job/?gh_jid=1431558) ï¼Œæˆ–æ˜¯ä¾†ä¿¡ [cuk.bas@gmail.com](mailto:cuk.bas@gmail.com) æˆ‘å¯ä»¥å¹«å¿™è½‰ä»‹ã€‚

### å‚™è¨»èˆ‡å…¶ä»–åƒè€ƒ

*   \*1 ç°¡å–®èªªä¾†ï¼ŒElement æ˜¯ä¸€å€‹Plain Object ï¼Œæè¿°è‘—ä½¿ç”¨å“ªäº›Component ï¼Œä»¥åŠå…¶åƒæ•¸ï¼ˆpropsï¼‰ï¼Œä¹Ÿå°±æ˜¯é–‹ç™¼è€…å¯«æˆJSX å½¢å¼æ‰€æœƒè¢«ç·¨è­¯å‡ºçš„æ¨£å­ï¼›è€ŒComponent å‰‡æ˜¯ä¸€å€‹ä»¥è³‡æ–™ç‚ºé€²ã€UI ç‚ºå‡ºçš„å‡½æ•¸ã€‚
*   Mixins Are Dead. Long Live Composition([Dan Abramov](https://medium.com/@dan_abramov?source=post_header_lockup))â€Šâ€”â€Š[https://medium.com/@dan\_abramov/mixins-are-dead-long-live-higher-order-components-94a0d2f9e750](https://medium.com/@dan_abramov/mixins-are-dead-long-live-higher-order-components-94a0d2f9e750)
*   When to NOT use Render Props ([Kent C. Dodds](https://blog.kentcdodds.com/@kentcdodds?source=post_header_lockup))â€Šâ€”â€Š[https://blog.kentcdodds.com/when-to-not-use-render-props-5397bbeff746](https://blog.kentcdodds.com/when-to-not-use-render-props-5397bbeff746)
